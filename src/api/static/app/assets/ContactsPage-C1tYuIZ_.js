import{r as i,j as e}from"./index-DumVsrUo.js";import{a as f}from"./api-client-CDvRtWmo.js";import{g as b}from"./work-item-utils-RZsWa1qH.js";import{S as j,a as B,C,b as k}from"./card-5goLwclf.js";import{E as O}from"./error-state-0kbzh6rb.js";import{E as T}from"./empty-state-BkVfrRpV.js";import{B as u}from"./button-r2jIDO2w.js";import{B as w}from"./badge-Bt36TJcq.js";import{S as I}from"./scroll-area-B_tK9JRv.js";import"./bell-DBqOWW5H.js";import"./mail-CZlx0NVq.js";import"./users-DLMdm1he.js";import"./search-Bfd7H3IF.js";import"./index-C1JUgJ-4.js";function N(l){return l.endpoints.find(a=>a.type==="email")?.value||null}function Z(){const[l,x]=i.useState({kind:"loading"}),[a,S]=i.useState(""),[n,v]=i.useState(null),[h,m]=i.useState(!1),[E,d]=i.useState(!1),[o,g]=i.useState(null),[A,p]=i.useState(!1),r=i.useCallback(async t=>{try{const s=t?`/api/contacts?search=${encodeURIComponent(t)}`:"/api/contacts",c=await f.get(s);x({kind:"loaded",contacts:c.contacts,total:c.total})}catch(s){const c=s instanceof Error?s.message:"Unknown error";x({kind:"error",message:c})}},[]);i.useEffect(()=>{r()},[r]),i.useEffect(()=>{const t=setTimeout(()=>{r(a||void 0)},300);return()=>clearTimeout(t)},[a,r]);const D=t=>{v(t),m(!0)},F=async t=>{p(!0);try{await f.post("/api/contacts",t),d(!1),r(a||void 0)}catch(s){console.error("Failed to create contact:",s)}finally{p(!1)}},$=async t=>{if(o){p(!0);try{await f.patch(`/api/contacts/${o.id}`,t),d(!1),g(null),m(!1),r(a||void 0)}catch(s){console.error("Failed to update contact:",s)}finally{p(!1)}}},z=async t=>{if(confirm(`Delete contact "${t.display_name}"?`))try{await f.delete(`/api/contacts/${t.id}`),m(!1),v(null),r(a||void 0)}catch(s){console.error("Failed to delete contact:",s)}},_=t=>{g(t),m(!1),d(!0)},y=()=>{g(null),d(!0)};return l.kind==="loading"?e.jsxs("div",{"data-testid":"page-contacts",className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(j,{width:200,height:32}),e.jsx(j,{width:120,height:36})]}),e.jsx(j,{width:"100%",height:40,className:"mb-4"}),e.jsx(B,{count:5,variant:"card"})]}):l.kind==="error"?e.jsx("div",{"data-testid":"page-contacts",className:"p-6",children:e.jsx(O,{type:"generic",title:"Failed to load contacts",description:l.message,onRetry:()=>{x({kind:"loading"}),r()}})}):e.jsxs("div",{"data-testid":"page-contacts",className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"People"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[l.total," contact",l.total!==1?"s":""]})]}),e.jsx(u,{onClick:y,children:"Add Contact"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search contacts...",value:a,onChange:t=>S(t.target.value),className:"w-full max-w-md px-4 py-2 border rounded-md bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"})}),l.contacts.length===0?e.jsx(C,{children:e.jsx(k,{className:"p-8",children:e.jsx(T,{variant:"no-data",title:a?"No contacts found":"No contacts yet",description:a?"Try a different search term.":"Add your first contact to get started.",action:a?void 0:{label:"Add Contact",onClick:y}})})}):e.jsx(C,{className:"flex-1",children:e.jsx(k,{className:"p-0",children:e.jsx(I,{className:"h-[calc(100vh-280px)]",children:e.jsx("div",{className:"divide-y",children:l.contacts.map(t=>{const s=N(t);return e.jsxs("button",{onClick:()=>D(t),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:b(t.display_name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:t.display_name}),s&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s})]}),e.jsxs(w,{variant:"secondary",className:"shrink-0",children:[t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})]},t.id)})})})})}),n&&e.jsxs("div",{className:`fixed inset-0 z-50 ${h?"":"pointer-events-none"}`,children:[e.jsx("div",{className:`absolute inset-0 bg-black/50 transition-opacity ${h?"opacity-100":"opacity-0"}`,onClick:()=>m(!1)}),e.jsx("div",{className:`absolute right-0 top-0 h-full w-96 max-w-full bg-background shadow-lg transform transition-transform ${h?"translate-x-0":"translate-x-full"}`,children:e.jsxs("div",{className:"p-6 h-full overflow-auto",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"flex size-16 items-center justify-center rounded-full bg-primary/10 text-xl font-medium text-primary",children:b(n.display_name)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:n.display_name}),N(n)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:N(n)})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>_(n),children:"Edit"}),e.jsx(u,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>z(n),children:"Delete"})]}),n.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md",children:n.notes})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Endpoints"}),n.endpoints.length>0?e.jsx("div",{className:"space-y-2",children:n.endpoints.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(w,{variant:"outline",className:"text-xs",children:t.type}),e.jsx("span",{className:"text-muted-foreground",children:t.value})]},s))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No endpoints"})]})]})})]}),E&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>d(!1)}),e.jsxs("div",{className:"relative bg-background rounded-lg shadow-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:o?"Edit Contact":"Add Contact"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault();const s=new FormData(t.currentTarget),c={displayName:s.get("displayName"),notes:s.get("notes")||void 0};o?$(c):F(c)},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"displayName",className:"block text-sm font-medium mb-1",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{id:"displayName",name:"displayName",type:"text",required:!0,defaultValue:o?.display_name||"",className:"w-full px-3 py-2 border rounded-md bg-background focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"John Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx("textarea",{id:"notes",name:"notes",rows:3,defaultValue:o?.notes||"",className:"w-full px-3 py-2 border rounded-md bg-background focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Additional notes..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(u,{type:"submit",disabled:A,children:o?"Save Changes":"Add Contact"})]})]})]})]})]})}export{Z as ContactsPage};
//# sourceMappingURL=ContactsPage-C1tYuIZ_.js.map
