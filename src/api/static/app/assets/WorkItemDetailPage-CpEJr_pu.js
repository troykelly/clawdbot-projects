import{S as Dt,s as Tt,h as we,g as It,n as Pe,b as H,r as h,c as Et,d as Pt,j as e,e as $t,L as X}from"./index-DumVsrUo.js";import{w as U,P as ae,T as he,L as xe,d as pe,G as At,D as fe,a as ge,b as je,c as J,R as Lt,I as Rt,h as $e,i as qt,f as Kt,g as Ut,U as Ot}from"./use-work-item-delete-D939N_lH.js";import{u as Ae}from"./useQuery-Euy325s0.js";import{a as q}from"./api-client-CDvRtWmo.js";import{r as Ft,b as Vt,c as Wt}from"./work-item-utils-RZsWa1qH.js";import{C as A,b as L,c as Bt,d as de,e as me,S as ze}from"./card-5goLwclf.js";import{C as Me,E as Qt}from"./error-state-0kbzh6rb.js";import{c as D,B as f,a as w,u as Le,e as Ht}from"./button-r2jIDO2w.js";import{B as E}from"./badge-Bt36TJcq.js";import{P as Re,S as Gt}from"./scroll-area-B_tK9JRv.js";import{I as V,C as ue}from"./input-Cutmt5wx.js";import{C as qe}from"./chevron-right-CBsWH2ZT.js";import{C as ie,S as Yt,a as Xt,b as Jt,c as Zt,d as es,u as ts}from"./select-B8H9MuWW.js";import{X as ve,F as Ne,P as Q,D as ss,a as as,b as is,c as ns,d as rs,f as cs}from"./dialog-D49-HonL.js";import{F as ne,C as W,U as ls}from"./users-DLMdm1he.js";import{U as Ke}from"./user-DwRicg5s.js";import{T as Ue}from"./textarea-edfU6-ro.js";import{E as Oe}from"./eye-CwC3I2ZM.js";import{P as F,c as B,a as Fe,u as os}from"./index-C1JUgJ-4.js";import{a as Ve,d as ds,u as ms}from"./index-0mpa9FNi.js";import{M as Z}from"./mail-CZlx0NVq.js";import{L as us}from"./list-Co1VQB_c.js";import{N as hs}from"./network-RV8gJEGm.js";var xs=class extends Dt{#t;#a=void 0;#e;#s;constructor(t,s){super(),this.#t=t,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#t.defaultMutationOptions(t),Tt(this.options,s)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),s?.mutationKey&&this.options.mutationKey&&we(s.mutationKey)!==we(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#n()}mutate(t,s){return this.#s=s,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(t)}#i(){const t=this.#e?.state??It();this.#a={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){Pe.batch(()=>{if(this.#s&&this.hasListeners()){const s=this.#a.variables,a=this.#a.context,n={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#s.onSuccess?.(t.data,s,a,n)}catch(c){Promise.reject(c)}try{this.#s.onSettled?.(t.data,null,s,a,n)}catch(c){Promise.reject(c)}}else if(t?.type==="error"){try{this.#s.onError?.(t.error,s,a,n)}catch(c){Promise.reject(c)}try{this.#s.onSettled?.(void 0,t.error,s,a,n)}catch(c){Promise.reject(c)}}}this.listeners.forEach(s=>{s(this.#a)})})}};function be(t,s){const a=H(),[n]=h.useState(()=>new xs(a,t));h.useEffect(()=>{n.setOptions(t)},[n,t]);const c=h.useSyncExternalStore(h.useCallback(r=>n.subscribe(Pe.batchCalls(r)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),i=h.useCallback((r,l)=>{n.mutate(r,l).catch(Et)},[n]);if(c.error&&Pt(n.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:i,mutateAsync:c.mutate}}const ps=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],fs=D("arrow-left",ps);const gs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],js=D("arrow-right",gs);const vs=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],Ns=D("bold",vs);const bs=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],ys=D("brain",bs);const ks=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],Cs=D("code",ks);const ws=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],ye=D("ellipsis-vertical",ws);const zs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ms=D("external-link",zs);const _s=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],Ss=D("italic",_s);const Ds=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],R=D("link-2",Ds);const Ts=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],Is=D("list-ordered",Ts);const Es=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ps=D("map-pin",Es);const $s=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],As=D("paperclip",$s);const Ls=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Rs=D("pen-line",Ls);const qs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ks=D("pen",qs);const Us=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],We=D("unlink",Us);const Os=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Fs=D("video",Os),$={all:["memories"],lists:()=>[...$.all,"list"],list:()=>[...$.lists()],forWorkItem:t=>[...$.all,"work-item",t]};function Vs(t){return Ae({queryKey:$.forWorkItem(t),queryFn:({signal:s})=>q.get(`/api/work-items/${t}/memories`,{signal:s}),enabled:!!t})}const ee={all:["communications"],forWorkItem:t=>[...ee.all,"work-item",t]};function Ws(t){return Ae({queryKey:ee.forWorkItem(t),queryFn:({signal:s})=>q.get(`/api/work-items/${t}/communications`,{signal:s}),enabled:!!t})}function Bs(){const t=H();return be({mutationFn:({id:s,body:a})=>q.put(`/api/work-items/${s}`,a),onMutate:async({id:s,body:a})=>{await t.cancelQueries({queryKey:U.detail(s)});const n=t.getQueryData(U.detail(s));if(n){const c={...n,...a.title!==void 0?{title:a.title}:{},...a.status!==void 0?{status:a.status}:{},...a.priority!==void 0?{priority:a.priority}:{},...a.description!==void 0?{description:a.description}:{}};t.setQueryData(U.detail(s),c)}return{previousDetail:n}},onError:(s,{id:a},n)=>{n?.previousDetail&&t.setQueryData(U.detail(a),n.previousDetail)},onSettled:(s,a,{id:n})=>{t.invalidateQueries({queryKey:U.detail(n)}),t.invalidateQueries({queryKey:U.lists()}),t.invalidateQueries({queryKey:U.tree()})}})}function Qs(){const t=H();return be({mutationFn:({workItemId:s,body:a})=>q.post(`/api/work-items/${s}/memories`,a),onSuccess:(s,{workItemId:a})=>{t.invalidateQueries({queryKey:$.forWorkItem(a)}),t.invalidateQueries({queryKey:$.lists()})}})}function Hs(){const t=H();return be({mutationFn:({id:s,body:a})=>q.patch(`/api/memories/${s}`,a),onSuccess:(s,{workItemId:a})=>{t.invalidateQueries({queryKey:$.lists()}),a&&t.invalidateQueries({queryKey:$.forWorkItem(a)})}})}function Gs(t){switch(t){case"project":return e.jsx(Ne,{className:"size-5"});case"initiative":return e.jsx(pe,{className:"size-5"});case"epic":return e.jsx(xe,{className:"size-5"});case"issue":return e.jsx(ne,{className:"size-5"})}}function Ys(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Xs(t){switch(t){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Js(t){return t.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())}function Zs({title:t,kind:s,status:a,parentTitle:n,onTitleChange:c,onParentClick:i,onDelete:r,className:l}){const[u,p]=h.useState(!1),[d,m]=h.useState(t),x=()=>{m(t),p(!0)},N=()=>{d.trim()&&d!==t&&c?.(d.trim()),p(!1)},M=()=>{m(t),p(!1)},b=v=>{v.key==="Enter"?N():v.key==="Escape"&&M()};return e.jsxs("div",{className:w("space-y-2",l),children:[n&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("button",{className:"hover:text-foreground hover:underline",onClick:i,children:n}),e.jsx(qe,{className:"size-4"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 text-muted-foreground",children:Gs(s)}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{value:d,onChange:v=>m(v.target.value),onKeyDown:b,autoFocus:!0,className:"text-xl font-semibold"}),e.jsxs(f,{variant:"ghost",size:"icon",onClick:N,children:[e.jsx(ie,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Save"})]}),e.jsxs(f,{variant:"ghost",size:"icon",onClick:M,children:[e.jsx(ve,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Cancel"})]})]}):e.jsxs("div",{className:"group flex items-start gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:t}),c&&e.jsxs(f,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 group-hover:opacity-100",onClick:x,children:[e.jsx(ae,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Edit title"})]}),r&&e.jsxs(f,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 text-destructive hover:text-destructive group-hover:opacity-100",onClick:r,children:[e.jsx(he,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(E,{variant:"outline",children:Ys(s)}),e.jsx(E,{variant:Xs(a),children:Js(a)})]})]})]})]})}function _e(t){return t?t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"Not set"}function Se(t){if(!t)return"Not set";if(t<60)return`${t}m`;const s=Math.floor(t/60),a=t%60;return a>0?`${s}h ${a}m`:`${s}h`}function O({icon:t,label:s,value:a,editable:n,onEdit:c,editType:i="text",options:r}){const[l,u]=h.useState(!1),[p,d]=h.useState(a),m=()=>{c?.(p),u(!1)},x=()=>{d(a),u(!1)};return e.jsxs("div",{className:"flex items-start gap-3 rounded-md p-2 hover:bg-muted/50",children:[e.jsx("span",{className:"mt-0.5 text-muted-foreground",children:t}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:s}),l?e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[i==="select"&&r?e.jsxs(Yt,{value:p,onValueChange:d,children:[e.jsx(Xt,{className:"h-8 text-sm",children:e.jsx(Jt,{})}),e.jsx(Zt,{children:r.map(N=>e.jsx(es,{value:N.value,children:N.label},N.value))})]}):i==="date"?e.jsx(V,{type:"date",value:p,onChange:N=>d(N.target.value),className:"h-8 text-sm"}):e.jsx(V,{type:i==="number"?"number":"text",value:p,onChange:N=>d(N.target.value),className:"h-8 text-sm"}),e.jsx(f,{variant:"ghost",size:"icon",className:"size-6",onClick:m,children:e.jsx(ie,{className:"size-3"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"size-6",onClick:x,children:e.jsx(ve,{className:"size-3"})})]}):e.jsxs("div",{className:"group flex items-center gap-1",children:[e.jsx("p",{className:"text-sm",children:a}),n&&c&&e.jsx(f,{variant:"ghost",size:"icon",className:"size-5 opacity-0 group-hover:opacity-100",onClick:()=>u(!0),children:e.jsx(ae,{className:"size-3"})})]})]})]})}const De=[{value:"not_started",label:"Not Started"},{value:"in_progress",label:"In Progress"},{value:"blocked",label:"Blocked"},{value:"done",label:"Done"},{value:"cancelled",label:"Cancelled"}],Te=[{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];function ea({status:t,priority:s,assignee:a,dueDate:n,startDate:c,estimateMinutes:i,actualMinutes:r,onStatusChange:l,onPriorityChange:u,onAssigneeChange:p,onDueDateChange:d,onStartDateChange:m,onEstimateChange:x,onActualChange:N,className:M}){const b=g=>Te.find(C=>C.value===g)?.label??g,v=g=>De.find(C=>C.value===g)?.label??g;return e.jsxs("div",{className:w("grid gap-1 sm:grid-cols-2",M),children:[e.jsx(O,{icon:e.jsx(Me,{className:"size-4"}),label:"Status",value:v(t),editable:!!l,onEdit:g=>l?.(g),editType:"select",options:De}),e.jsx(O,{icon:e.jsx(Me,{className:"size-4"}),label:"Priority",value:b(s),editable:!!u,onEdit:g=>u?.(g),editType:"select",options:Te}),e.jsx(O,{icon:e.jsx(Ke,{className:"size-4"}),label:"Assignee",value:a||"Unassigned",editable:!!p,onEdit:p}),e.jsx(O,{icon:e.jsx(W,{className:"size-4"}),label:"Due Date",value:_e(n),editable:!!d,onEdit:d,editType:"date"}),e.jsx(O,{icon:e.jsx(W,{className:"size-4"}),label:"Start Date",value:_e(c),editable:!!m,onEdit:m,editType:"date"}),e.jsx(O,{icon:e.jsx(ue,{className:"size-4"}),label:"Estimate",value:Se(i),editable:!!x,onEdit:x,editType:"number"}),e.jsx(O,{icon:e.jsx(ue,{className:"size-4"}),label:"Actual",value:Se(r),editable:!!N,onEdit:N,editType:"number"})]})}function ta({description:t,onDescriptionChange:s,className:a}){const[n,c]=h.useState(!1),[i,r]=h.useState(t||""),[l,u]=h.useState(!1),p=()=>{r(t||""),c(!0),u(!1)},d=()=>{s?.(i),c(!1)},m=()=>{r(t||""),c(!1),u(!1)},x=N=>N?N.split(`
`).map((b,v)=>{if(b.startsWith("### "))return e.jsx("h4",{className:"mt-4 mb-2 text-sm font-semibold",children:b.slice(4)},v);if(b.startsWith("## "))return e.jsx("h3",{className:"mt-4 mb-2 font-semibold",children:b.slice(3)},v);if(b.startsWith("# "))return e.jsx("h2",{className:"mt-4 mb-2 text-lg font-semibold",children:b.slice(2)},v);if(b.startsWith("- ")||b.startsWith("* "))return e.jsx("li",{className:"ml-4",children:b.slice(2)},v);if(!b.trim())return e.jsx("br",{},v);const g=C=>{const S=[];let y=C,P=0;for(;y.length>0;){const j=y.match(/^`([^`]+)`/);if(j){S.push(e.jsx("code",{className:"rounded bg-muted px-1 text-sm",children:j[1]},P++)),y=y.slice(j[0].length);continue}const k=y.match(/^\*\*([^*]+)\*\*/);if(k){S.push(e.jsx("strong",{children:k[1]},P++)),y=y.slice(k[0].length);continue}const _=y.match(/^\*([^*]+)\*/);if(_){S.push(e.jsx("em",{children:_[1]},P++)),y=y.slice(_[0].length);continue}const z=y.search(/[`*]/);if(z===-1){S.push(y);break}else z===0?(S.push(y[0]),y=y.slice(1)):(S.push(y.slice(0,z)),y=y.slice(z))}return S};return e.jsx("p",{className:"my-1",children:g(b)},v)}):null;return e.jsxs("div",{className:w("space-y-3",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Description"}),!n&&s&&e.jsxs(f,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:p,children:[e.jsx(ae,{className:"size-3"}),"Edit"]}),n&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(f,{variant:"ghost",size:"sm",className:w("h-7 gap-1",!l&&"bg-muted"),onClick:()=>u(!1),children:[e.jsx(Ks,{className:"size-3"}),"Edit"]}),e.jsxs(f,{variant:"ghost",size:"sm",className:w("h-7 gap-1",l&&"bg-muted"),onClick:()=>u(!0),children:[e.jsx(Oe,{className:"size-3"}),"Preview"]})]})]}),n?e.jsxs("div",{className:"space-y-3",children:[l?e.jsx("div",{className:"min-h-32 rounded-md border bg-muted/30 p-3 text-sm",children:i?x(i):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})}):e.jsx(Ue,{value:i,onChange:N=>r(N.target.value),placeholder:"Add a description... (Markdown supported)",className:"min-h-32 font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:m,children:[e.jsx(ve,{className:"mr-1 size-3"}),"Cancel"]}),e.jsxs(f,{size:"sm",onClick:d,children:[e.jsx(ie,{className:"mr-1 size-3"}),"Save"]})]})]}):t?e.jsx("div",{className:"prose prose-sm max-w-none rounded-md bg-muted/30 p-3",children:x(t)}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No description"})]})}var re="Checkbox",[sa]=Fe(re),[aa,ke]=sa(re);function ia(t){const{__scopeCheckbox:s,checked:a,children:n,defaultChecked:c,disabled:i,form:r,name:l,onCheckedChange:u,required:p,value:d="on",internal_do_not_use_render:m}=t,[x,N]=Ve({prop:a,defaultProp:c??!1,onChange:u,caller:re}),[M,b]=h.useState(null),[v,g]=h.useState(null),C=h.useRef(!1),S=M?!!r||!!M.closest("form"):!0,y={checked:x,disabled:i,setChecked:N,control:M,setControl:b,name:l,form:r,value:d,hasConsumerStoppedPropagationRef:C,required:p,defaultChecked:K(c)?!1:c,isFormControl:S,bubbleInput:v,setBubbleInput:g};return e.jsx(aa,{scope:s,...y,children:na(m)?m(y):n})}var Be="CheckboxTrigger",Qe=h.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:a,...n},c)=>{const{control:i,value:r,disabled:l,checked:u,required:p,setControl:d,setChecked:m,hasConsumerStoppedPropagationRef:x,isFormControl:N,bubbleInput:M}=ke(Be,t),b=Le(c,d),v=h.useRef(u);return h.useEffect(()=>{const g=i?.form;if(g){const C=()=>m(v.current);return g.addEventListener("reset",C),()=>g.removeEventListener("reset",C)}},[i,m]),e.jsx(F.button,{type:"button",role:"checkbox","aria-checked":K(u)?"mixed":u,"aria-required":p,"data-state":Ze(u),"data-disabled":l?"":void 0,disabled:l,value:r,...n,ref:b,onKeyDown:B(s,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:B(a,g=>{m(C=>K(C)?!0:!C),M&&N&&(x.current=g.isPropagationStopped(),x.current||g.stopPropagation())})})});Qe.displayName=Be;var He=h.forwardRef((t,s)=>{const{__scopeCheckbox:a,name:n,checked:c,defaultChecked:i,required:r,disabled:l,value:u,onCheckedChange:p,form:d,...m}=t;return e.jsx(ia,{__scopeCheckbox:a,checked:c,defaultChecked:i,disabled:l,required:r,onCheckedChange:p,name:n,form:d,value:u,internal_do_not_use_render:({isFormControl:x})=>e.jsxs(e.Fragment,{children:[e.jsx(Qe,{...m,ref:s,__scopeCheckbox:a}),x&&e.jsx(Je,{__scopeCheckbox:a})]})})});He.displayName=re;var Ge="CheckboxIndicator",Ye=h.forwardRef((t,s)=>{const{__scopeCheckbox:a,forceMount:n,...c}=t,i=ke(Ge,a);return e.jsx(Re,{present:n||K(i.checked)||i.checked===!0,children:e.jsx(F.span,{"data-state":Ze(i.checked),"data-disabled":i.disabled?"":void 0,...c,ref:s,style:{pointerEvents:"none",...t.style}})})});Ye.displayName=Ge;var Xe="CheckboxBubbleInput",Je=h.forwardRef(({__scopeCheckbox:t,...s},a)=>{const{control:n,hasConsumerStoppedPropagationRef:c,checked:i,defaultChecked:r,required:l,disabled:u,name:p,value:d,form:m,bubbleInput:x,setBubbleInput:N}=ke(Xe,t),M=Le(a,N),b=ts(i),v=ds(n);h.useEffect(()=>{const C=x;if(!C)return;const S=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(S,"checked").set,j=!c.current;if(b!==i&&P){const k=new Event("click",{bubbles:j});C.indeterminate=K(i),P.call(C,K(i)?!1:i),C.dispatchEvent(k)}},[x,b,i,c]);const g=h.useRef(K(i)?!1:i);return e.jsx(F.input,{type:"checkbox","aria-hidden":!0,defaultChecked:r??g.current,required:l,disabled:u,name:p,value:d,form:m,...s,tabIndex:-1,ref:M,style:{...s.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Je.displayName=Xe;function na(t){return typeof t=="function"}function K(t){return t==="indeterminate"}function Ze(t){return K(t)?"indeterminate":t?"checked":"unchecked"}function ra({className:t,...s}){return e.jsx(He,{"data-slot":"checkbox",className:w("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(Ye,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(ie,{className:"size-3.5"})})})}function ca({todos:t,onAdd:s,onToggle:a,onDelete:n,className:c}){const[i,r]=h.useState(""),l=()=>{i.trim()&&s&&(s(i.trim()),r(""))},u=d=>{d.key==="Enter"&&l()},p=t.filter(d=>d.completed).length;return e.jsxs("div",{className:w("space-y-3",c),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Checklist"}),t.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p,"/",t.length," completed"]})]}),t.length>0&&e.jsx("div",{className:"h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${p/t.length*100}%`}})}),e.jsx("div",{className:"space-y-1",children:t.map(d=>e.jsxs("div",{"data-testid":"todo-item",className:w("group flex items-center gap-2 rounded-md px-2 py-1.5","hover:bg-muted/50"),children:[e.jsx(At,{className:"size-4 cursor-grab text-muted-foreground opacity-0 group-hover:opacity-100"}),e.jsx(ra,{checked:d.completed,onCheckedChange:m=>a?.(d.id,m===!0),"aria-label":`Mark "${d.text}" as ${d.completed?"incomplete":"complete"}`}),e.jsx("span",{className:w("flex-1 text-sm",d.completed&&"text-muted-foreground line-through"),children:d.text}),n&&e.jsxs(f,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:()=>n(d.id),children:[e.jsx(he,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]},d.id))}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"size-4 text-muted-foreground"}),e.jsx(V,{value:i,onChange:d=>r(d.target.value),onKeyDown:u,placeholder:"Add a task...",className:"h-8 flex-1"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:l,disabled:!i.trim(),children:"Add"})]}),t.length===0&&!s&&e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No tasks yet"})]})}function la(t){switch(t){case"memory":return e.jsx(ys,{className:"size-4"});case"contact":return e.jsx(Ke,{className:"size-4"});case"email":return e.jsx(Z,{className:"size-4"});case"calendar":return e.jsx(W,{className:"size-4"})}}function oa(t){switch(t){case"memory":return"Memory";case"contact":return"Contact";case"email":return"Email";case"calendar":return"Event"}}function da({attachments:t,onAttachmentClick:s,onLinkNew:a,className:n}){const c=h.useMemo(()=>{const r={memory:[],contact:[],email:[],calendar:[]};for(const l of t)r[l.type].push(l);return r},[t]),i=t.length>0;return e.jsxs("div",{className:w("space-y-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Linked Items"}),a&&e.jsxs(f,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:a,children:[e.jsx(R,{className:"size-3"}),"Link"]})]}),i?e.jsx("div",{className:"space-y-4",children:Object.entries(c).filter(([r,l])=>l.length>0).map(([r,l])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[la(r),oa(r),"s (",l.length,")"]}),e.jsx("div",{className:"space-y-1",children:l.map(u=>e.jsxs("button",{"data-testid":"attachment-item",className:w("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",s&&"cursor-pointer"),onClick:()=>s?.(u),children:[e.jsxs("span",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate text-sm",children:u.title}),u.subtitle&&e.jsx("span",{className:"block truncate text-xs text-muted-foreground",children:u.subtitle})]}),s&&e.jsx(Ms,{className:"size-3 shrink-0 text-muted-foreground"})]},u.id))})]},r))}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No linked items"})]})}function ma(t){switch(t){case"project":return e.jsx(Ne,{className:"size-4"});case"initiative":return e.jsx(pe,{className:"size-4"});case"epic":return e.jsx(xe,{className:"size-4"});case"issue":return e.jsx(ne,{className:"size-4"})}}function ua(t){switch(t){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function ha(t){return t.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())}function xa({dependencies:t,onDependencyClick:s,onAddDependency:a,className:n}){const c=t.filter(l=>l.direction==="blocked_by"),i=t.filter(l=>l.direction==="blocks"),r=l=>e.jsxs("button",{"data-testid":"dependency-item",className:w("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",s&&"cursor-pointer"),onClick:()=>s?.(l),children:[e.jsx("span",{className:"text-muted-foreground",children:ma(l.kind)}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm",children:l.title}),e.jsx(E,{variant:ua(l.status),className:"shrink-0 text-xs",children:ha(l.status)})]},l.id);return e.jsxs("div",{className:w("space-y-4",n),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(fs,{className:"size-4"}),"Blocked by (",c.length,")"]}),a&&e.jsxs(f,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocked_by"),children:[e.jsx(Q,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add blocker"})]})]}),c.length>0?e.jsx("div",{className:"space-y-1",children:c.map(r)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No blockers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(js,{className:"size-4"}),"Blocks (",i.length,")"]}),a&&e.jsxs(f,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocks"),children:[e.jsx(Q,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add dependent"})]})]}),i.length>0?e.jsx("div",{className:"space-y-1",children:i.map(r)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No dependents"})]})]})}function pa({item:t,onTitleChange:s,onDescriptionChange:a,onStatusChange:n,onPriorityChange:c,onAssigneeChange:i,onDueDateChange:r,onStartDateChange:l,onEstimateChange:u,onActualChange:p,onTodoAdd:d,onTodoToggle:m,onTodoDelete:x,onAttachmentClick:N,onLinkAttachment:M,onDependencyClick:b,onAddDependency:v,onParentClick:g,onDelete:C,className:S}){return e.jsx("div",{className:w("flex h-full flex-col",S),children:e.jsx(Gt,{className:"flex-1",children:e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 p-6",children:[e.jsx(Zs,{title:t.title,kind:t.kind,status:t.status,parentTitle:t.parentTitle,onTitleChange:s,onParentClick:g,onDelete:C}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(ea,{status:t.status,priority:t.priority,assignee:t.assignee,dueDate:t.dueDate,startDate:t.startDate,estimateMinutes:t.estimateMinutes,actualMinutes:t.actualMinutes,onStatusChange:n,onPriorityChange:c,onAssigneeChange:i,onDueDateChange:r,onStartDateChange:l,onEstimateChange:u,onActualChange:p})})}),e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(ta,{description:t.description,onDescriptionChange:a})})}),e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(ca,{todos:t.todos,onAdd:d,onToggle:m,onDelete:x})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(da,{attachments:t.attachments,onAttachmentClick:N,onLinkNew:M})})}),e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(xa,{dependencies:t.dependencies,onDependencyClick:b,onAddDependency:v})})})]})]})]})})})}function fa(t){switch(t){case"project":return e.jsx(Ne,{className:"size-3"});case"initiative":return e.jsx(pe,{className:"size-3"});case"epic":return e.jsx(xe,{className:"size-3"});case"issue":return e.jsx(ne,{className:"size-3"});default:return null}}function ga({memory:t,onClick:s,onEdit:a,onDelete:n,className:c}){const i=t.content.slice(0,150)+(t.content.length>150?"...":"");return e.jsxs("div",{"data-testid":"memory-card",className:w("group relative rounded-lg border bg-card p-4 transition-colors hover:bg-accent/50",s&&"cursor-pointer",c),onClick:()=>s?.(t),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium leading-tight",children:t.title}),(a||n)&&e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:r=>r.stopPropagation(),children:e.jsx(ye,{className:"size-4"})})}),e.jsxs(je,{align:"end",children:[a&&e.jsxs(J,{onClick:r=>{r.stopPropagation(),a(t)},children:[e.jsx(ae,{className:"mr-2 size-4"}),"Edit"]}),n&&e.jsxs(J,{className:"text-destructive focus:text-destructive",onClick:r=>{r.stopPropagation(),n(t)},children:[e.jsx(he,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:i}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.linkedItemKind&&t.linkedItemTitle&&e.jsxs("span",{className:"flex items-center gap-1",children:[fa(t.linkedItemKind),e.jsx("span",{className:"truncate max-w-[120px]",children:t.linkedItemTitle})]})}),e.jsx("span",{children:t.updatedAt.toLocaleDateString()})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:t.tags.map(r=>e.jsx(E,{variant:"secondary",className:"text-xs",children:r},r))})]})}function ja({memories:t,onMemoryClick:s,onAddMemory:a,onLinkMemory:n,onEditMemory:c,onDeleteMemory:i,className:r}){return e.jsxs("div",{className:w("space-y-4",r),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Memories"}),e.jsx(E,{variant:"secondary",className:"text-xs",children:t.length})]}),e.jsxs("div",{className:"flex gap-1",children:[n&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:n,children:[e.jsx(R,{className:"mr-1 size-3"}),"Link"]}),a&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:a,children:[e.jsx(Q,{className:"mr-1 size-3"}),"Add"]})]})]}),t.length>0?e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:t.map(l=>e.jsx(ga,{memory:l,onClick:s,onEdit:c,onDelete:i},l.id))}):e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx(ne,{className:"mx-auto size-8 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"No memories attached"}),(a||n)&&e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[a&&e.jsxs(f,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(Q,{className:"mr-1 size-3"}),"Create new"]}),n&&e.jsxs(f,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(R,{className:"mr-1 size-3"}),"Link existing"]})]})]})]})}var ce="Tabs",[va]=Fe(ce,[$e]),et=$e(),[Na,Ce]=va(ce),tt=h.forwardRef((t,s)=>{const{__scopeTabs:a,value:n,onValueChange:c,defaultValue:i,orientation:r="horizontal",dir:l,activationMode:u="automatic",...p}=t,d=os(l),[m,x]=Ve({prop:n,onChange:c,defaultProp:i??"",caller:ce});return e.jsx(Na,{scope:a,baseId:ms(),value:m,onValueChange:x,orientation:r,dir:d,activationMode:u,children:e.jsx(F.div,{dir:d,"data-orientation":r,...p,ref:s})})});tt.displayName=ce;var st="TabsList",at=h.forwardRef((t,s)=>{const{__scopeTabs:a,loop:n=!0,...c}=t,i=Ce(st,a),r=et(a);return e.jsx(Lt,{asChild:!0,...r,orientation:i.orientation,dir:i.dir,loop:n,children:e.jsx(F.div,{role:"tablist","aria-orientation":i.orientation,...c,ref:s})})});at.displayName=st;var it="TabsTrigger",nt=h.forwardRef((t,s)=>{const{__scopeTabs:a,value:n,disabled:c=!1,...i}=t,r=Ce(it,a),l=et(a),u=lt(r.baseId,n),p=ot(r.baseId,n),d=n===r.value;return e.jsx(Rt,{asChild:!0,...l,focusable:!c,active:d,children:e.jsx(F.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":p,"data-state":d?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:u,...i,ref:s,onMouseDown:B(t.onMouseDown,m=>{!c&&m.button===0&&m.ctrlKey===!1?r.onValueChange(n):m.preventDefault()}),onKeyDown:B(t.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&r.onValueChange(n)}),onFocus:B(t.onFocus,()=>{const m=r.activationMode!=="manual";!d&&!c&&m&&r.onValueChange(n)})})})});nt.displayName=it;var rt="TabsContent",ct=h.forwardRef((t,s)=>{const{__scopeTabs:a,value:n,forceMount:c,children:i,...r}=t,l=Ce(rt,a),u=lt(l.baseId,n),p=ot(l.baseId,n),d=n===l.value,m=h.useRef(d);return h.useEffect(()=>{const x=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(x)},[]),e.jsx(Re,{present:c||d,children:({present:x})=>e.jsx(F.div,{"data-state":d?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":u,hidden:!x,id:p,tabIndex:0,...r,ref:s,style:{...t.style,animationDuration:m.current?"0s":void 0},children:x&&i})})});ct.displayName=rt;function lt(t,s){return`${t}-trigger-${s}`}function ot(t,s){return`${t}-content-${s}`}var ba=tt,ya=at,ka=nt,Ca=ct;function dt({className:t,orientation:s="horizontal",...a}){return e.jsx(ba,{"data-slot":"tabs","data-orientation":s,orientation:s,className:w("group/tabs flex gap-2 data-[orientation=horizontal]:flex-col",t),...a})}const wa=Ht("rounded-lg p-[3px] group-data-[orientation=horizontal]/tabs:h-9 data-[variant=line]:rounded-none group/tabs-list text-muted-foreground inline-flex w-fit items-center justify-center group-data-[orientation=vertical]/tabs:h-fit group-data-[orientation=vertical]/tabs:flex-col",{variants:{variant:{default:"bg-muted",line:"gap-1 bg-transparent"}},defaultVariants:{variant:"default"}});function mt({className:t,variant:s="default",...a}){return e.jsx(ya,{"data-slot":"tabs-list","data-variant":s,className:w(wa({variant:s}),t),...a})}function te({className:t,...s}){return e.jsx(ka,{"data-slot":"tabs-trigger",className:w("focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground/60 hover:text-foreground dark:text-muted-foreground dark:hover:text-foreground relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all group-data-[orientation=vertical]/tabs:w-full group-data-[orientation=vertical]/tabs:justify-start focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 group-data-[variant=default]/tabs-list:data-[state=active]:shadow-sm group-data-[variant=line]/tabs-list:data-[state=active]:shadow-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","group-data-[variant=line]/tabs-list:bg-transparent group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:border-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent","data-[state=active]:bg-background dark:data-[state=active]:text-foreground dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 data-[state=active]:text-foreground","after:bg-foreground after:absolute after:opacity-0 after:transition-opacity group-data-[orientation=horizontal]/tabs:after:inset-x-0 group-data-[orientation=horizontal]/tabs:after:bottom-[-5px] group-data-[orientation=horizontal]/tabs:after:h-0.5 group-data-[orientation=vertical]/tabs:after:inset-y-0 group-data-[orientation=vertical]/tabs:after:-right-1 group-data-[orientation=vertical]/tabs:after:w-0.5 group-data-[variant=line]/tabs-list:data-[state=active]:after:opacity-100",t),...s})}function se({className:t,...s}){return e.jsx(Ca,{"data-slot":"tabs-content",className:w("flex-1 outline-none",t),...s})}function za({memory:t,open:s,onOpenChange:a,onSubmit:n,className:c}){const[i,r]=h.useState(t?.title??""),[l,u]=h.useState(t?.content??""),[p,d]=h.useState(""),[m,x]=h.useState(t?.tags??[]),[N,M]=h.useState("edit"),b=h.useRef(null),v=h.useCallback((j,k="")=>{const _=b.current;if(!_)return;const z=_.selectionStart,G=_.selectionEnd,Y=l.slice(z,G),le=l.slice(0,z)+j+(Y||"text")+k+l.slice(G);u(le),setTimeout(()=>{_.focus();const I=z+j.length,oe=I+(Y||"text").length;_.setSelectionRange(I,oe)},0)},[l]),g=()=>{const j=p.trim();j&&!m.includes(j)&&(x([...m,j]),d(""))},C=j=>{x(m.filter(k=>k!==j))},S=j=>{j.preventDefault(),n({title:i.trim(),content:l.trim(),tags:m.length>0?m:void 0})},y=i.trim()&&l.trim(),P=j=>j.split(`
`).map((k,_)=>k.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:k.slice(4)},_):k.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-4 mb-2",children:k.slice(3)},_):k.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",children:k.slice(2)},_):k.startsWith("- ")||k.startsWith("* ")?e.jsx("li",{className:"ml-4",children:k.slice(2)},_):/^\d+\. /.test(k)?e.jsx("li",{className:"ml-4 list-decimal",children:k.replace(/^\d+\. /,"")},_):k.trim()?e.jsx("p",{className:"my-1",children:k},_):e.jsx("br",{},_));return e.jsx(ss,{open:s,onOpenChange:a,children:e.jsxs(as,{className:w("sm:max-w-2xl",c),children:[e.jsxs(is,{children:[e.jsx(ns,{children:t?"Edit Memory":"Create Memory"}),e.jsx(rs,{className:"sr-only",children:t?"Edit memory details":"Create a new memory entry"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(V,{id:"memory-title",value:i,onChange:j=>r(j.target.value),placeholder:"Memory title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsxs(dt,{value:N,onValueChange:j=>M(j),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("**","**"),title:"Bold",children:e.jsx(Ns,{className:"size-4"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("*","*"),title:"Italic",children:e.jsx(Ss,{className:"size-4"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("- "),title:"Bullet list",children:e.jsx(us,{className:"size-4"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("1. "),title:"Numbered list",children:e.jsx(Is,{className:"size-4"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("[","](url)"),title:"Link",children:e.jsx(R,{className:"size-4"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("`","`"),title:"Code",children:e.jsx(Cs,{className:"size-4"})})]}),e.jsxs(mt,{children:[e.jsxs(te,{value:"edit",className:"gap-1",children:[e.jsx(Rs,{className:"size-3"}),"Edit"]}),e.jsxs(te,{value:"preview",className:"gap-1",children:[e.jsx(Oe,{className:"size-3"}),"Preview"]})]})]}),e.jsx(se,{value:"edit",className:"mt-2",children:e.jsx(Ue,{ref:b,value:l,onChange:j=>u(j.target.value),placeholder:"Write your memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0})}),e.jsx(se,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"min-h-[200px] rounded-md border bg-muted/30 p-4 text-sm",children:l?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:P(l)}):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-tags",className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{id:"memory-tags",value:p,onChange:j=>d(j.target.value),placeholder:"Add a tag",onKeyDown:j=>{j.key==="Enter"&&(j.preventDefault(),g())}}),e.jsx(f,{type:"button",variant:"outline",onClick:g,children:"Add"})]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:m.map(j=>e.jsxs(E,{variant:"secondary",className:"cursor-pointer",onClick:()=>C(j),children:[j," Ã—"]},j))})]}),e.jsxs(cs,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(f,{type:"submit",disabled:!y,children:t?"Save Changes":"Create Memory"})]})]})]})})}function Ma({email:t,onClick:s,onUnlink:a,className:n}){return e.jsxs("div",{"data-testid":"email-card",className:w("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",s&&"cursor-pointer",!t.isRead&&"border-l-2 border-l-primary",n),onClick:()=>s?.(t),children:[e.jsx("div",{className:"mt-0.5 flex size-8 shrink-0 items-center justify-center rounded-full bg-primary/10",children:e.jsx(Z,{className:"size-4 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:w("truncate text-sm",!t.isRead&&"font-semibold"),children:t.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.from.name||t.from.email})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[t.hasAttachments&&e.jsx(As,{className:"size-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:_a(t.date)}),a&&e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:c=>c.stopPropagation(),children:e.jsx(ye,{className:"size-4"})})}),e.jsx(je,{align:"end",children:e.jsxs(J,{className:"text-destructive focus:text-destructive",onClick:c=>{c.stopPropagation(),a(t)},children:[e.jsx(We,{className:"mr-2 size-4"}),"Unlink"]})})]})]})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-muted-foreground",children:t.snippet})]})]})}function _a(t){const a=new Date().getTime()-t.getTime(),n=Math.floor(a/(1e3*60*60*24));return n===0?t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):n===1?"Yesterday":n<7?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}function Sa({event:t,onClick:s,onUnlink:a,className:n}){const c=t.endTime<new Date,i=Da(t.startTime,new Date);return e.jsxs("div",{"data-testid":"calendar-event-card",className:w("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",s&&"cursor-pointer",c&&"opacity-60",n),onClick:()=>s?.(t),children:[e.jsxs("div",{className:w("flex size-12 shrink-0 flex-col items-center justify-center rounded-lg",i?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("span",{className:"text-[10px] font-medium uppercase",children:t.startTime.toLocaleDateString([],{weekday:"short"})}),e.jsx("span",{className:"text-lg font-bold",children:t.startTime.getDate()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-medium leading-tight",children:t.title}),a&&e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:r=>r.stopPropagation(),children:e.jsx(ye,{className:"size-4"})})}),e.jsx(je,{align:"end",children:e.jsxs(J,{className:"text-destructive focus:text-destructive",onClick:r=>{r.stopPropagation(),a(t)},children:[e.jsx(We,{className:"mr-2 size-4"}),"Unlink"]})})]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ue,{className:"size-3"}),e.jsx("span",{children:t.isAllDay?"All day":`${Ie(t.startTime)} - ${Ie(t.endTime)}`})]}),t.location&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ps,{className:"size-3"}),e.jsx("span",{className:"truncate",children:t.location})]}),t.meetingLink&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-primary",children:[e.jsx(Fs,{className:"size-3"}),e.jsx("span",{children:"Video meeting"})]}),t.attendees.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(ls,{className:"size-3 text-muted-foreground"}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.attendees.slice(0,3).map((r,l)=>e.jsx(E,{variant:r.status==="accepted"?"default":r.status==="declined"?"destructive":"secondary",className:"text-[10px] px-1.5 py-0",children:r.name.split(" ")[0]},r.email)),t.attendees.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",t.attendees.length-3]})]})]})]})]})}function Ie(t){return t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Da(t,s){return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}function Ta({emails:t,calendarEvents:s,onEmailClick:a,onEventClick:n,onUnlinkEmail:c,onUnlinkEvent:i,onLinkEmail:r,onLinkEvent:l,className:u}){const[p,d]=h.useState("emails"),m=t.length+s.length;return e.jsxs("div",{className:w("space-y-4",u),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Communications"}),e.jsx(E,{variant:"secondary",className:"text-xs",children:m})]})}),e.jsxs(dt,{value:p,onValueChange:x=>d(x),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(mt,{children:[e.jsxs(te,{value:"emails",className:"gap-1",children:[e.jsx(Z,{className:"size-3"}),"Emails",t.length>0&&e.jsx(E,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:t.length})]}),e.jsxs(te,{value:"calendar",className:"gap-1",children:[e.jsx(W,{className:"size-3"}),"Calendar",s.length>0&&e.jsx(E,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:s.length})]})]}),p==="emails"&&r&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(R,{className:"mr-1 size-3"}),"Link Email"]}),p==="calendar"&&l&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:l,children:[e.jsx(R,{className:"mr-1 size-3"}),"Link Event"]})]}),e.jsx(se,{value:"emails",className:"mt-4",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(x=>e.jsx(Ma,{email:x,onClick:a,onUnlink:c},x.id))}):e.jsx(Ee,{icon:e.jsx(Z,{className:"size-8"}),message:"No linked emails",action:r&&e.jsxs(f,{variant:"outline",size:"sm",onClick:r,children:[e.jsx(R,{className:"mr-1 size-3"}),"Link an email"]})})}),e.jsx(se,{value:"calendar",className:"mt-4",children:s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(x=>e.jsx(Sa,{event:x,onClick:n,onUnlink:i},x.id))}):e.jsx(Ee,{icon:e.jsx(W,{className:"size-8"}),message:"No linked calendar events",action:l&&e.jsxs(f,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(R,{className:"mr-1 size-3"}),"Link an event"]})})})]})]})}function Ee({icon:t,message:s,action:a}){return e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx("div",{className:"mx-auto text-muted-foreground/50",children:t}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:s}),a&&e.jsx("div",{className:"mt-3",children:a})]})}function ti(){const{id:t}=$t(),s=t??"",a=H(),c=Ft()?.participants??[],{data:i,isLoading:r,error:l}=qt(s),{data:u,isLoading:p}=Vs(s),{data:d,isLoading:m}=Ws(s),x=Bs(),N=Qs(),M=Hs(),[b,v]=h.useState(!1),[g,C]=h.useState(null),[S,y]=h.useState(!1),{deleteItem:P,isDeleting:j,undoState:k,dismissUndo:_}=Kt({onDeleted:()=>{window.location.href="/app/work-items"}}),z=i?(()=>{const o=[];return i.dependencies?.blocks&&o.push(...i.dependencies.blocks.map(T=>({id:T.id,title:T.title,kind:"issue",status:"not_started",direction:"blocks"}))),i.dependencies?.blocked_by&&o.push(...i.dependencies.blocked_by.map(T=>({id:T.id,title:T.title,kind:"issue",status:"not_started",direction:"blocked_by"}))),{id:i.id,title:i.title,kind:i.kind||"issue",status:i.status||"not_started",priority:Vt(i.priority),description:i.description||void 0,parentId:i.parent_id||void 0,parentTitle:i.parent?.title,estimateMinutes:i.estimate_minutes||void 0,actualMinutes:i.actual_minutes||void 0,dueDate:i.not_after?new Date(i.not_after):void 0,startDate:i.not_before?new Date(i.not_before):void 0,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at),todos:[],attachments:[],dependencies:o}})():null,G=(u?.memories??[]).map(o=>({id:o.id,title:o.title,content:o.content,linkedItemId:s,linkedItemTitle:z?.title||void 0,linkedItemKind:z?.kind||"issue",createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)})),Y=(d?.emails??[]).map(o=>({id:o.id,subject:"Email",from:{name:"Unknown",email:""},to:[],date:o.received_at?new Date(o.received_at):new Date,snippet:o.body?.substring(0,100)||"",body:o.body||void 0})),le=(d?.calendar_events??[]).map(o=>({id:o.id,title:"Calendar Event",startTime:o.received_at?new Date(o.received_at):new Date,endTime:o.received_at?new Date(o.received_at):new Date,attendees:[]})),I=h.useCallback(o=>{x.mutate({id:s,body:o})},[s,x]),oe=o=>I({title:o}),ut=o=>I({description:o}),ht=o=>I({status:o}),xt=o=>I({priority:Wt(o)}),pt=o=>I({notAfter:o||null}),ft=o=>I({notBefore:o||null}),gt=o=>{const T=parseInt(o,10);I({estimateMinutes:isNaN(T)?null:T})},jt=o=>{const T=parseInt(o,10);I({actualMinutes:isNaN(T)?null:T})},vt=()=>{z?.parentId&&(window.location.href=`/app/work-items/${z.parentId}`)},Nt=o=>{window.location.href=`/app/work-items/${o.id}`},bt=()=>{C(null),v(!0)},yt=o=>{C(o),v(!0)},kt=o=>{N.mutate({workItemId:s,body:{title:o.title,content:o.content,type:"note"}},{onSuccess:()=>v(!1)})},Ct=o=>{g&&M.mutate({id:g.id,body:{title:o.title,content:o.content},workItemId:s},{onSuccess:()=>{v(!1),C(null)}})},wt=async o=>{if(confirm(`Delete memory "${o.title}"?`))try{await q.delete(`/api/memories/${o.id}`),a.invalidateQueries({queryKey:$.forWorkItem(s)})}catch{}},zt=async o=>{if(confirm("Unlink this email from the work item?"))try{await q.delete(`/api/work-items/${s}/communications/${o.id}`),a.invalidateQueries({queryKey:ee.forWorkItem(s)})}catch{}},Mt=async o=>{if(confirm("Unlink this event from the work item?"))try{await q.delete(`/api/work-items/${s}/communications/${o.id}`),a.invalidateQueries({queryKey:ee.forWorkItem(s)})}catch{}},_t=()=>y(!0),St=async()=>{z&&(await P({id:z.id,title:z.title}),y(!1))};return r?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(Bt,{})}):l||!z?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(Qt,{title:"Work Item Not Found",message:l instanceof Error?l.message:"The requested work item could not be loaded.",action:e.jsx(f,{variant:"outline",asChild:!0,children:e.jsx(X,{to:"/work-items",children:"Back to Work Items"})})})}):e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b flex items-center gap-4",children:[e.jsx(f,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(X,{to:"/work-items",children:[e.jsx(qe,{className:"mr-1 size-4 rotate-180"}),"Back"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(X,{to:`/work-items/${s}/timeline`,children:[e.jsx(W,{className:"mr-2 size-4"}),"Timeline"]})}),e.jsx(f,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(X,{to:`/work-items/${s}/graph`,children:[e.jsx(hs,{className:"mr-2 size-4"}),"Dependencies"]})})]})]}),e.jsx(pa,{item:z,onTitleChange:oe,onDescriptionChange:ut,onStatusChange:ht,onPriorityChange:xt,onDueDateChange:pt,onStartDateChange:ft,onEstimateChange:gt,onActualChange:jt,onParentClick:vt,onDependencyClick:Nt,onDelete:_t,className:"flex-1"}),e.jsxs("div",{className:"p-6 space-y-6 border-t",children:[e.jsxs(A,{children:[e.jsx(de,{children:e.jsx(me,{className:"text-lg",children:"Memories"})}),e.jsx(L,{children:p?e.jsx(ze,{width:"100%",height:100}):e.jsx(ja,{memories:G,onAddMemory:bt,onEditMemory:yt,onDeleteMemory:wt})})]}),e.jsx(za,{memory:g||void 0,open:b,onOpenChange:v,onSubmit:g?Ct:kt}),e.jsxs(A,{children:[e.jsx(de,{children:e.jsx(me,{className:"text-lg",children:"Communications"})}),e.jsx(L,{children:m?e.jsx(ze,{width:"100%",height:100}):e.jsx(Ta,{emails:Y,calendarEvents:le,onUnlinkEmail:zt,onUnlinkEvent:Mt})})]}),e.jsxs(A,{children:[e.jsx(de,{children:e.jsx(me,{className:"text-lg",children:"Participants"})}),e.jsx(L,{children:c.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No participants assigned"}):e.jsx("ul",{className:"space-y-2",children:c.map((o,T)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:(o.participant??"U")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm",children:o.participant??"Unknown"}),o.role&&e.jsx(E,{variant:"outline",className:"text-xs",children:o.role})]},T))})})]})]}),e.jsx(Ut,{open:S,onOpenChange:y,item:z?{id:z.id,title:z.title,kind:z.kind,childCount:0}:void 0,onConfirm:St,isDeleting:j}),k&&e.jsx(Ot,{visible:!!k,itemTitle:k.itemTitle,onUndo:k.onUndo,onDismiss:_})]})}export{ti as WorkItemDetailPage};
//# sourceMappingURL=WorkItemDetailPage-CpEJr_pu.js.map
